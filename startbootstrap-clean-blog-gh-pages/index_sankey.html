<!DOCTYPE html>
<html lang="en">

<style>
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
.link:hover {
  stroke-opacity: .5;
}
</style>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Languages in the ACL Anthology</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- Custom styles for this template -->
  <link href="css/clean-blog.min.css" rel="stylesheet">

</head>

<body>
  <!--Import the D3 Library (version 4 in this case)-->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="//d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
  <!-- Load the sankey.js function -->
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/sankey.js"></script>

  <!-- <script src="https://unpkg.com/d3-sankey@0"></script> -->
  <!-- TODO: Remove this? -->
  <!-- <script src="http://vizjs.org/viz.v1.1.0.min.js"></script> -->

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Languages</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">About</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <header class="masthead" style="background-image: url('img/language-tree.png')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Languages in the ACL Anthology</h1>
            <h2 class="subheading">On language diversity in NLP research</h2>
            <span class="meta">Posted by
              <a href="#">Annebeth Buis</a>
              on December 15, 2019</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Post Content -->
  <article>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <p>There are approximately 7000 languages in the world, according to <a href="https://www.ethnologue.com/" target="_blank">Ethnologue</a>.</p>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <h2 class="section-heading">Number of publications per language</h2>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <div id="visualization_1"></div>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <!-- <blockquote class="blockquote">The dreams of yesterday are the hopes of today and the reality of tomorrow. Science has not yet mastered prophecy. We predict too much for the next year and yet far too little for the next ten.</blockquote> -->

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <h2 class="section-heading">Languages and research topics</h2>

          <div id="visualization_2"></div>

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

          <!-- <span class="caption text-muted">To go places and do things that have never been done before – that’s what living is all about.</span> -->

          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tristique arcu turpis, in aliquet leo fermentum ac. Nam ac luctus velit. Fusce quis felis vitae libero vulputate tristique vitae id dolor. Integer velit libero, congue ut metus sit amet, aliquam gravida quam. Etiam dictum faucibus rutrum. Mauris aliquam lacus et.</p>

        </div>
      </div>
    </div>
  </article>

  <hr>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <p class="copyright text-muted">Copyright &copy; Annebeth Buis 2019</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/clean-blog.min.js"></script>

</body>

<script>

    // VISUALIZATION 1: STACKED AREA CHART
    // Inspiration from: https://www.d3-graph-gallery.com/graph/stackedarea_template.html

    // Set up the bounds of the visualization
    var margin = { top: 40, right: 40, bottom: 60, left: 0 };
    var width = 1200 - margin.right - margin.left;
    var height = 550 - margin.top - margin.bottom;

    // Set up the first SVG that gives us a canvas to draw on
    var svg = d3.select("#visualization_1").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    //Read the data
    d3.csv("data.csv", (function(data) {

      // List of groups = header of the csv files
      var keys = data.columns.slice(1)

      // color palette
      var color = d3.scaleOrdinal()
        .domain(keys)
        .range(d3.schemeSet2);

      //stack the data?
      var stackedData = d3.stack()
        .keys(keys)
        (data)

      // Add X axis
      var x = d3.scaleLinear()
        .domain(d3.extent(data, function(d) { return d.year; }))
        .range([ 0, width ]);
      var xAxis = svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(5))

      // Add X axis label:
      svg.append("text")
          .attr("text-anchor", "end")
          .attr("x", width)
          .attr("y", height+40 )
          .text("Year");

      // Add Y axis label:
      svg.append("text")
          .attr("text-anchor", "end")
          .attr("x", 0)
          .attr("y", -20 )
          .text("# of papers")
          .attr("text-anchor", "start")

      // Add Y axis
      var y = d3.scaleLinear()
        .domain([0, 350])
        .range([ height, 0 ]);
      svg.append("g")
        .call(d3.axisLeft(y).ticks(5))

      // Add a clipPath: everything out of this area won't be drawn.
      var clip = svg.append("defs").append("svg:clipPath")
          .attr("id", "clip")
          .append("svg:rect")
          .attr("width", width )
          .attr("height", height )
          .attr("x", 0)
          .attr("y", 0);

      // Add brushing
      var brush = d3.brushX()                 // Add the brush feature using the d3.brush function
          .extent( [ [0,0], [width,height] ] ) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area
          .on("end", updateChart) // Each time the brush selection changes, trigger the 'updateChart' function

      // Create the scatter variable: where both the circles and the brush take place
      var areaChart = svg.append('g')
        .attr("clip-path", "url(#clip)")

      // Area generator
      var area = d3.area()
        .x(function(d) { return x(d.data.year); })
        .y0(function(d) { return y(d[0]); })
        .y1(function(d) { return y(d[1]); })

      // Show the areas
      areaChart
        .selectAll("mylayers")
        .data(stackedData)
        .enter()
        .append("path")
          .attr("class", function(d) { return "myArea " + createClassName(d.key) })
          .style("fill", function(d) { return color(d.key); })
          .attr("d", area)

      // Add the brushing
      areaChart
        .append("g")
          .attr("class", "brush")
          .call(brush);

      var idleTimeout
      function idled() { idleTimeout = null; }

      // A function that update the chart for given boundaries
      function updateChart() {

        extent = d3.event.selection

        // If no selection, back to initial coordinate. Otherwise, update X axis domain
        if(!extent){
          if (!idleTimeout) return idleTimeout = setTimeout(idled, 350); // This allows to wait a little bit
          x.domain(d3.extent(data, function(d) { return d.year; }))
        }else{
          x.domain([ x.invert(extent[0]), x.invert(extent[1]) ])
          areaChart.select(".brush").call(brush.move, null) // This remove the grey brush area as soon as the selection has been done
        }

        // Update axis and area position
        xAxis.transition().duration(1000).call(d3.axisBottom(x).ticks(5))
        areaChart
          .selectAll("path")
          .transition().duration(1000)
          .attr("d", area)
        }

        // What to do when one group is hovered
        var highlight = function(d){
          console.log(d)
          // reduce opacity of all groups
          d3.selectAll(".myArea").style("opacity", .1)
          // expect the one that is hovered
          d3.select("."+createClassName(d)).style("opacity", 1)
        }

        // And when it is not hovered anymore
        var noHighlight = function(d){
          d3.selectAll(".myArea").style("opacity", 1)
        }

        // Add one dot in the legend for each name.
        var size = 20
        svg.selectAll("myrect")
          .data(keys)
          .enter()
          .append("rect")
            .attr("x", 25)
            .attr("y", function(d,i){ return 20 + i*(size+5)}) // 100 is where the first dot appears. 25 is the distance between dots
            .attr("width", size)
            .attr("height", size)
            .style("fill", function(d){ return color(d)})
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

        // Add one dot in the legend for each name.
        svg.selectAll("mylabels")
          .data(keys)
          .enter()
          .append("text")
            .attr("x", 25 + size*1.2)
            .attr("y", function(d,i){ return 20 + i*(size+5) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots
            .style("fill", function(d){ return color(d)})
            .text(function(d){ return d})
            .attr("text-anchor", "left")
            .style("alignment-baseline", "middle")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

    }))

    // VISUALIZATION 2: LANGUAGE-TOPIC SANKEY
    // Inspiration from: TODO.

    var sankey = d3.sankey();

    // Set up the bounds of the visualization
    var margin = { top: 40, right: 400, bottom: 60, left: 60 };
    var width = 1200 - margin.right - margin.left;
    var height = 2200 - margin.top - margin.bottom;

    // Set up the first SVG that gives us a canvas to draw on
    var svg_2 = d3.select("#visualization_2").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Color scale used
    var color = d3.scaleOrdinal(d3.schemeCategory20);

    // Set the sankey diagram properties
    var sankey = d3.sankey()
        .nodeWidth(36)
        .nodePadding(29)
        .size([width, height]);

    // load the data
    d3.json("sankey_data.json", function(error, graph) {

      console.log("graph", graph);

      var nodeMap = {};
      graph.nodes.forEach(function(x) { nodeMap[x.name] = x; });
      graph.links = graph.links.map(function(x) {
        return {
          source: nodeMap[x.source],
          target: nodeMap[x.target],
          value: x.value
        };
      });

      console.log("links", graph.links);

      // Constructs a new Sankey generator with the default settings.
      sankey
          .nodes(graph.nodes)
          .links(graph.links)
          .layout(1);

      // add in the links
      var link = svg_2.append("g")
        .selectAll(".link")
        .data(graph.links)
        .enter()
        .append("path")
          .attr("class", "link")
          .attr("d", sankey.link() )
          .style("stroke-width", function(d) { return Math.max(1, d.dy); })
          .sort(function(a, b) { return b.dy - a.dy; });

      // add in the nodes
      var node = svg_2.append("g")
        .selectAll(".node")
        .data(graph.nodes)
        .enter().append("g")
          .attr("class", "node")
          .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
          .call(d3.drag()
            .subject(function(d) { return d; })
            .on("start", function() { this.parentNode.appendChild(this); })
            .on("drag", dragmove));

      // add the rectangles for the nodes
      node
        .append("rect")
          .attr("height", function(d) { return d.dy; })
          .attr("width", sankey.nodeWidth())
          .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
          .style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
        // Add hover text
        .append("title")
          .text(function(d) { return d.name + "\n" + "There is " + d.value + " stuff in this node"; });

      // add in the title for the nodes
        node
          .append("text")
            .attr("x", -6)
            .attr("y", function(d) { return d.dy / 2; })
            .attr("dy", ".35em")
            .attr("text-anchor", "end")
            .attr("transform", null)
            .text(function(d) { return d.name; })
          .filter(function(d) { return d.x < width / 2; })
            .attr("x", 6 + sankey.nodeWidth())
            .attr("text-anchor", "start");

      // the function for moving the nodes
      function dragmove(d) {
        d3.select(this)
          .attr("transform",
                "translate("
                   + d.x + ","
                   + (d.y = Math.max(
                      0, Math.min(height - d.dy, d3.event.y))
                     ) + ")");
        sankey.relayout();
        link.attr("d", sankey.link() );
      }

    });

// Function for creating stacked area class names
function createClassName(key) {
  return key.replace(/ /g, "_").toLowerCase();
}

</script>

</html>
